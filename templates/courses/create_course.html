{% extends "base.html" %}

{% block title %}Create New Course{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modules/course-management.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ url_for('courses.list_courses') }}">
                            <i class="bi bi-mortarboard"></i> Courses
                        </a>
                    </li>
                    <li class="breadcrumb-item active">Create New Course</li>
                </ol>
            </nav>
            <h2 class="mb-1">
                <i class="bi bi-plus-lg text-primary"></i> Create New Course
            </h2>
            <p class="text-muted mb-0">Add a new course to your training institute's offerings</p>
        </div>
    </div>

    <!-- Course Creation Form -->
    <form method="POST" action="{{ url_for('courses.create_course') }}" class="needs-validation" novalidate>
        <div class="row">
            <!-- Left Column - Basic Information -->
            <div class="col-lg-8">
                <!-- Basic Course Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Basic Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="course_name" class="form-label required">Course Name</label>
                                <input type="text" class="form-control" id="course_name" name="course_name" 
                                       placeholder="e.g., Advanced Excel with VBA" required>
                                <div class="invalid-feedback">Please provide a course name.</div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="course_code" class="form-label">Course Code</label>
                                <input type="text" class="form-control" id="course_code" name="course_code" 
                                       placeholder="e.g., EXL-ADV">
                                <div class="form-text">Auto-generated if left blank</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label required">Category</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Digital Foundations">Digital Foundations</option>
                                    <option value="Programming & AI">Programming & AI</option>
                                    <option value="Finance & Accounting">Finance & Accounting</option>
                                    <option value="Communication & Soft Skills">Communication & Soft Skills</option>
                                    <option value="Programming">Programming</option>
                                    <option value="Office Suite">Office Suite</option>
                                    <option value="Web Development">Web Development</option>
                                    <option value="Data Science">Data Science</option>
                                    <option value="Digital Marketing">Digital Marketing</option>
                                    <option value="Graphic Design">Graphic Design</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Networking">Networking</option>
                                    <option value="Cloud Computing">Cloud Computing</option>
                                    <option value="Mobile Development">Mobile Development</option>
                                    <option value="Other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select a category.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="difficulty_level" class="form-label">Difficulty Level</label>
                                <select class="form-select" id="difficulty_level" name="difficulty_level">
                                    <option value="Beginner" selected>Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                    <option value="Expert">Expert</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Course Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"
                                      placeholder="Brief description of the course..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Duration and Timing -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-clock"></i> Duration & Timing</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="duration" class="form-label required">Duration</label>
                                <input type="text" class="form-control" id="duration" name="duration" 
                                       placeholder="e.g., 3 Months, 120 Hours" required>
                                <div class="invalid-feedback">Please provide course duration.</div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="duration_in_hours" class="form-label">Total Hours</label>
                                <input type="number" class="form-control" id="duration_in_hours" name="duration_in_hours" 
                                       placeholder="e.g., 120" min="1">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="duration_in_days" class="form-label">Total Days</label>
                                <input type="number" class="form-control" id="duration_in_days" name="duration_in_days" 
                                       placeholder="e.g., 60" min="1">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="delivery_mode" class="form-label">Delivery Mode</label>
                                <select class="form-select" id="delivery_mode" name="delivery_mode">
                                    <option value="Classroom" selected>Classroom</option>
                                    <option value="Online">Online</option>
                                    <option value="Hybrid">Hybrid</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="typical_schedule" class="form-label">Typical Schedule</label>
                                <input type="text" class="form-control" id="typical_schedule" name="typical_schedule" 
                                       placeholder="e.g., Mon-Fri 10AM-12PM">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="batch_size_min" class="form-label">Minimum Batch Size</label>
                                <input type="number" class="form-control" id="batch_size_min" name="batch_size_min" 
                                       value="5" min="1" max="50">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="batch_size_max" class="form-label">Maximum Batch Size</label>
                                <input type="number" class="form-control" id="batch_size_max" name="batch_size_max" 
                                       value="30" min="1" max="100">
                            </div>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="flexible_timing" name="flexible_timing" checked>
                            <label class="form-check-label" for="flexible_timing">
                                Flexible timing available
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Pricing Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-currency-rupee"></i> Pricing Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="fee" class="form-label required">Course Fee (₹)</label>
                                <input type="number" class="form-control" id="fee" name="fee" 
                                       placeholder="15000" min="0" step="1" required>
                                <div class="invalid-feedback">Please provide course fee.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="registration_fee" class="form-label">Registration Fee (₹)</label>
                                <input type="number" class="form-control" id="registration_fee" name="registration_fee" 
                                       placeholder="1000" min="0" step="1" value="0">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="material_fee" class="form-label">Material Fee (₹)</label>
                                <input type="number" class="form-control" id="material_fee" name="material_fee" 
                                       placeholder="500" min="0" step="1" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="certification_fee" class="form-label">Certification Fee (₹)</label>
                                <input type="number" class="form-control" id="certification_fee" name="certification_fee" 
                                       placeholder="1000" min="0" step="1" value="0">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="early_bird_discount" class="form-label">Early Bird Discount (%)</label>
                                <input type="number" class="form-control" id="early_bird_discount" name="early_bird_discount" 
                                       placeholder="10" min="0" max="50" step="1" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="group_discount" class="form-label">Group Discount (%)</label>
                                <input type="number" class="form-control" id="group_discount" name="group_discount" 
                                       placeholder="15" min="0" max="50" step="1" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Course Content -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-book"></i> Course Content</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="course_outline" class="form-label">Course Outline / Syllabus</label>
                            <textarea class="form-control" id="course_outline" name="course_outline" rows="6"
                                      placeholder="Detailed course outline with modules, topics, etc..."></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="learning_outcomes" class="form-label">Learning Outcomes</label>
                            <textarea class="form-control" id="learning_outcomes" name="learning_outcomes" rows="4"
                                      placeholder="What will students learn and achieve after completing this course?"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="prerequisites" class="form-label">Prerequisites</label>
                                <textarea class="form-control" id="prerequisites" name="prerequisites" rows="3"
                                          placeholder="Required prior knowledge or skills..."></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="software_requirements" class="form-label">Software Requirements</label>
                                <textarea class="form-control" id="software_requirements" name="software_requirements" rows="3"
                                          placeholder="Required software, tools, or hardware..."></textarea>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="target_audience" class="form-label">Target Audience</label>
                                <textarea class="form-control" id="target_audience" name="target_audience" rows="3"
                                          placeholder="Who should take this course?"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="career_opportunities" class="form-label">Career Opportunities</label>
                                <textarea class="form-control" id="career_opportunities" name="career_opportunities" rows="3"
                                          placeholder="Job opportunities after course completion..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Additional Settings -->
            <div class="col-lg-4">
                <!-- Certification & Assessment -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-award"></i> Certification & Assessment</h6>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="has_certification" name="has_certification" checked>
                            <label class="form-check-label" for="has_certification">
                                Course provides certification
                            </label>
                        </div>

                        <div class="mb-3">
                            <label for="certification_body" class="form-label">Certification Body</label>
                            <input type="text" class="form-control" id="certification_body" name="certification_body" 
                                   placeholder="e.g., Microsoft, Adobe, Institute Name">
                        </div>

                        <div class="mb-3">
                            <label for="assessment_type" class="form-label">Assessment Type</label>
                            <select class="form-select" id="assessment_type" name="assessment_type">
                                <option value="Both" selected>Project + Exam</option>
                                <option value="Project">Project Only</option>
                                <option value="Exam">Exam Only</option>
                                <option value="Continuous">Continuous Assessment</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="passing_criteria" class="form-label">Passing Criteria</label>
                            <input type="text" class="form-control" id="passing_criteria" name="passing_criteria" 
                                   placeholder="e.g., 60% in exam + project completion">
                        </div>
                    </div>
                </div>

                <!-- Course Settings -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-gear"></i> Course Settings</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select" id="status" name="status">
                                <option value="Active" selected>Active</option>
                                <option value="Draft">Draft</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="display_order" class="form-label">Display Order</label>
                            <input type="number" class="form-control" id="display_order" name="display_order" 
                                   value="100" min="1" max="999">
                            <div class="form-text">Lower numbers appear first</div>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured">
                            <label class="form-check-label" for="is_featured">
                                Featured Course
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_popular" name="is_popular">
                            <label class="form-check-label" for="is_popular">
                                Popular Course
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Quick Tips -->
                <div class="card bg-light">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-lightbulb"></i> Quick Tips</h6>
                    </div>
                    <div class="card-body">
                        <ul class="small mb-0">
                            <li>Use clear, descriptive course names</li>
                            <li>Set realistic batch sizes based on your capacity</li>
                            <li>Include detailed course outline for better student understanding</li>
                            <li>Set appropriate prerequisites to ensure student success</li>
                            <li>Consider offering early bird or group discounts</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <button type="submit" class="btn btn-primary btn-lg me-3">
                            <i class="bi bi-check-lg"></i> Create Course
                        </button>
                        <a href="{{ url_for('courses.list_courses') }}" class="btn btn-outline-secondary btn-lg">
                            <i class="bi bi-x-lg"></i> Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });
    });

    // Auto-generate course code from course name
    const courseNameInput = document.getElementById('course_name');
    const courseCodeInput = document.getElementById('course_code');
    
    courseNameInput.addEventListener('input', function() {
        if (!courseCodeInput.value) {
            const name = this.value.trim();
            if (name) {
                const words = name.toUpperCase().split(' ');
                let code = '';
                if (words.length >= 2) {
                    code = words.slice(0, 2).map(word => word.substring(0, 3)).join('-');
                } else {
                    code = words[0].substring(0, 6);
                }
                courseCodeInput.value = code;
            }
        }
    });

    // Validation for batch sizes
    const minBatchSize = document.getElementById('batch_size_min');
    const maxBatchSize = document.getElementById('batch_size_max');
    
    function validateBatchSizes() {
        const min = parseInt(minBatchSize.value) || 0;
        const max = parseInt(maxBatchSize.value) || 0;
        
        if (min > max && max > 0) {
            maxBatchSize.setCustomValidity('Maximum batch size must be greater than minimum batch size');
        } else {
            maxBatchSize.setCustomValidity('');
        }
    }
    
    minBatchSize.addEventListener('input', validateBatchSizes);
    maxBatchSize.addEventListener('input', validateBatchSizes);

    // Calculate total course cost
    const feeInput = document.getElementById('fee');
    const regFeeInput = document.getElementById('registration_fee');
    const materialFeeInput = document.getElementById('material_fee');
    const certFeeInput = document.getElementById('certification_fee');
    
    function updateTotalCost() {
        const courseFee = parseFloat(feeInput.value) || 0;
        const regFee = parseFloat(regFeeInput.value) || 0;
        const materialFee = parseFloat(materialFeeInput.value) || 0;
        const certFee = parseFloat(certFeeInput.value) || 0;
        const total = courseFee + regFee + materialFee + certFee;
        feeInput.setCustomValidity('');
    }
    
    [feeInput, regFeeInput, materialFeeInput, certFeeInput].forEach(input => {
        input.addEventListener('input', updateTotalCost);
    });
});
</script>
{% endblock %}
