{% extends "admin/content/base.html" %}

{% block title %}{{ assignment.assignment_title }}{% endblock %}
{% block page_icon %}fas fa-tasks{% endblock %}
{% block page_title %}{{ assignment.assignment_title }}{% endblock %}
{% block page_description %}Assignment details, configuration, and workflow management{% endblock %}

{% block header_actions %}
<div class="btn-group">
    <a href="{{ url_for('lms_content_management.assignment_list') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to List
    </a>
    {% if assignment.workflow_stage in ['draft', 'rejected', 'approved', 'published'] %}
    <a href="{{ url_for('lms_content_management.assignment_edit_form', assignment_id=assignment.id) }}" class="btn btn-outline-primary">
        <i class="fas fa-edit me-2"></i>
        {% if assignment.workflow_stage == 'published' %}Edit Published{% else %}Edit Assignment{% endif %}
    </a>
    {% endif %}
    {% if assignment.workflow_stage in ['draft', 'rejected'] %}
    <button class="btn btn-outline-danger" onclick="confirmDelete()">
        <i class="fas fa-trash me-2"></i>Delete Assignment
    </button>
    {% endif %}
    {% if assignment.workflow_stage == 'published' %}
    <!-- Published Assignment Actions -->
    <div class="btn-group ms-2">
        <button type="button" class="btn btn-outline-warning dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-cogs me-2"></i>Manage Published
        </button>
        <ul class="dropdown-menu">
            <li>
                <button class="dropdown-item" onclick="showUnpublishModal()">
                    <i class="fas fa-undo me-2"></i>Unpublish Assignment
                </button>
            </li>
            <li>
                <button class="dropdown-item" onclick="showRevisionModal()">
                    <i class="fas fa-copy me-2"></i>Create Revision
                </button>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
                <a class="dropdown-item" href="#" onclick="showEditHistory()">
                    <i class="fas fa-history me-2"></i>View Edit History
                </a>
            </li>
        </ul>
    </div>
    {% endif %}
    {% if assignment.workflow_stage == 'draft' %}
    <button class="btn btn-outline-info" onclick="submitForReview()">
        <i class="fas fa-paper-plane me-2"></i>Submit for Review
    </button>
    {% endif %}
    {% if assignment.workflow_stage == 'approved' %}
    <form method="POST" action="{{ url_for('lms_content_management.assignment_publish', assignment_id=assignment.id) }}" 
          style="display: inline;" onsubmit="return confirm('Are you sure you want to publish this assignment?')">
        <button type="submit" class="btn btn-success">
            <i class="fas fa-globe me-2"></i>Publish Assignment
        </button>
    </form>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<!-- Status Card -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-{% if assignment.workflow_stage == 'published' %}success{% elif assignment.workflow_stage == 'approved' %}primary{% elif assignment.workflow_stage == 'rejected' %}danger{% else %}warning{% endif %}">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="mb-1">
                            {% if assignment.workflow_stage == 'draft' %}
                                <span class="badge bg-warning">Draft</span>
                            {% elif assignment.workflow_stage == 'review' %}
                                <span class="badge bg-info">Under Review</span>
                            {% elif assignment.workflow_stage == 'approved' %}
                                <span class="badge bg-success">Approved</span>
                            {% elif assignment.workflow_stage == 'published' %}
                                <span class="badge bg-primary">Published</span>
                            {% elif assignment.workflow_stage == 'rejected' %}
                                <span class="badge bg-danger">Rejected</span>
                            {% endif %}
                            Assignment Status
                        </h5>
                        <p class="mb-0 text-muted">
                            Created {{ assignment.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                            {% if assignment.creator %}by {{ assignment.creator.full_name }}{% endif %}
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="d-flex justify-content-end align-items-center">
                            <div class="me-3">
                                <small class="text-muted">Max Score</small>
                                <div class="h4 mb-0">{{ assignment.max_score }} pts</div>
                            </div>
                            {% if assignment.assignment_type == 'project' %}
                                <i class="fas fa-project-diagram fa-2x text-primary"></i>
                            {% elif assignment.assignment_type == 'essay' %}
                                <i class="fas fa-pen-fancy fa-2x text-success"></i>
                            {% elif assignment.assignment_type == 'practical' %}
                                <i class="fas fa-laptop-code fa-2x text-info"></i>
                            {% elif assignment.assignment_type == 'presentation' %}
                                <i class="fas fa-presentation fa-2x text-warning"></i>
                            {% elif assignment.assignment_type == 'research' %}
                                <i class="fas fa-search fa-2x text-danger"></i>
                            {% else %}
                                <i class="fas fa-tasks fa-2x text-secondary"></i>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Assignment Details -->
    <div class="col-lg-8">
        <!-- Basic Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2 text-primary"></i>Assignment Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Title:</strong></div>
                    <div class="col-sm-9">{{ assignment.assignment_title }}</div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Type:</strong></div>
                    <div class="col-sm-9">
                        <span class="badge bg-secondary">{{ assignment.assignment_type|title }}</span>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Course:</strong></div>
                    <div class="col-sm-9">{{ assignment.course.course_name if assignment.course else 'Unknown Course' }}</div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Module:</strong></div>
                    <div class="col-sm-9">{{ assignment.module.module_name if assignment.module else 'Unknown Module' }}</div>
                </div>
                
                {% if assignment.section %}
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Section:</strong></div>
                    <div class="col-sm-9">{{ assignment.section.section_name }}</div>
                </div>
                {% endif %}
                
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Placement:</strong></div>
                    <div class="col-sm-9">
                        {{ assignment.assignment_placement|title }}-level 
                        {% if assignment.placement_order %}(Order: {{ assignment.placement_order }}){% endif %}
                    </div>
                </div>
                
                {% if assignment.assignment_description %}
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Description:</strong></div>
                    <div class="col-sm-9">{{ assignment.assignment_description }}</div>
                </div>
                {% endif %}
                
                {% if assignment.due_date %}
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Due Date:</strong></div>
                    <div class="col-sm-9">
                        <span class="{% if assignment.is_overdue() %}text-danger{% else %}text-dark{% endif %}">
                            {{ assignment.due_date.strftime('%B %d, %Y') }}
                        </span>
                        {% if assignment.is_overdue() %}
                        <span class="badge bg-danger ms-2">Overdue</span>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Instructions -->
        {% if assignment.detailed_instructions %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list-ol me-2 text-info"></i>Assignment Instructions
                </h5>
            </div>
            <div class="card-body">
                <div class="assignment-instructions">
                    {{ assignment.detailed_instructions|nl2br }}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Settings & Requirements -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-cog me-2 text-secondary"></i>Settings & Requirements
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">Assignment Settings</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-{% if assignment.is_mandatory %}check text-success{% else %}times text-danger{% endif %} me-2"></i>
                                {% if assignment.is_mandatory %}Mandatory Assignment{% else %}Optional Assignment{% endif %}
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-{% if assignment.requires_video_completion %}check text-success{% else %}times text-muted{% endif %} me-2"></i>
                                {% if assignment.requires_video_completion %}Requires Video Completion{% else %}No Video Prerequisite{% endif %}
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-{% if assignment.group_assignment %}check text-success{% else %}times text-muted{% endif %} me-2"></i>
                                {% if assignment.group_assignment %}Group Assignment{% else %}Individual Assignment{% endif %}
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-{% if assignment.late_submission_allowed %}check text-success{% else %}times text-muted{% endif %} me-2"></i>
                                {% if assignment.late_submission_allowed %}Late Submissions Allowed{% else %}No Late Submissions{% endif %}
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-info">Submission Details</h6>
                        <ul class="list-unstyled">
                            {% if assignment.submission_format %}
                            <li class="mb-2">
                                <i class="fas fa-file me-2 text-primary"></i>
                                <strong>Format:</strong> {{ assignment.submission_format }}
                            </li>
                            {% endif %}
                            {% if assignment.max_file_size_mb %}
                            <li class="mb-2">
                                <i class="fas fa-weight me-2 text-warning"></i>
                                <strong>Max Size:</strong> {{ assignment.max_file_size_mb }} MB
                            </li>
                            {% endif %}
                            {% if assignment.min_word_count %}
                            <li class="mb-2">
                                <i class="fas fa-align-left me-2 text-info"></i>
                                <strong>Min Words:</strong> {{ assignment.min_word_count }}
                            </li>
                            {% endif %}
                            {% if assignment.max_word_count %}
                            <li class="mb-2">
                                <i class="fas fa-align-right me-2 text-info"></i>
                                <strong>Max Words:</strong> {{ assignment.max_word_count }}
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grading Rubric -->
        {% if assignment.grading_rubric %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-star me-2 text-warning"></i>Grading Rubric
                </h5>
            </div>
            <div class="card-body">
                <div class="grading-rubric">
                    {{ assignment.get_grading_rubric_dict() }}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Workflow Timeline -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-history me-2 text-primary"></i>Workflow Timeline
                </h6>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item active">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">Created</h6>
                            <p class="mb-0 small text-muted">{{ assignment.created_at.strftime('%b %d, %Y %I:%M %p') }}</p>
                            {% if assignment.creator %}<p class="mb-0 small">by {{ assignment.creator.full_name }}</p>{% endif %}
                        </div>
                    </div>
                    
                    {% if assignment.reviewed_at %}
                    <div class="timeline-item active">
                        <div class="timeline-marker bg-info"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">Reviewed</h6>
                            <p class="mb-0 small text-muted">{{ assignment.reviewed_at.strftime('%b %d, %Y %I:%M %p') }}</p>
                            {% if assignment.reviewer %}<p class="mb-0 small">by {{ assignment.reviewer.full_name }}</p>{% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if assignment.approved_at %}
                    <div class="timeline-item active">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">Approved</h6>
                            <p class="mb-0 small text-muted">{{ assignment.approved_at.strftime('%b %d, %Y %I:%M %p') }}</p>
                            {% if assignment.approver %}<p class="mb-0 small">by {{ assignment.approver.full_name }}</p>{% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if assignment.published_at %}
                    <div class="timeline-item active">
                        <div class="timeline-marker bg-primary"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">Published</h6>
                            <p class="mb-0 small text-muted">{{ assignment.published_at.strftime('%b %d, %Y %I:%M %p') }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Comments & Feedback -->
        {% if assignment.reviewer_comments or assignment.rejection_reason %}
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-comments me-2 text-info"></i>Comments & Feedback
                </h6>
            </div>
            <div class="card-body">
                {% if assignment.reviewer_comments %}
                <div class="mb-3">
                    <h6 class="text-success">Reviewer Comments</h6>
                    <p class="mb-0">{{ assignment.reviewer_comments }}</p>
                </div>
                {% endif %}
                
                {% if assignment.rejection_reason %}
                <div class="mb-3">
                    <h6 class="text-danger">Rejection Reason</h6>
                    <p class="mb-0">{{ assignment.rejection_reason }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-bolt me-2 text-warning"></i>Quick Actions
                </h6>
            </div>
            <div class="card-body">
                {% if assignment.workflow_stage == 'review' %}
                <div class="d-grid gap-2">
                    <button class="btn btn-success" onclick="approveAssignment()">
                        <i class="fas fa-check me-2"></i>Approve Assignment
                    </button>
                    <button class="btn btn-danger" onclick="rejectAssignment()">
                        <i class="fas fa-times me-2"></i>Reject Assignment
                    </button>
                </div>
                {% elif assignment.workflow_stage == 'draft' %}
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="submitForReview()">
                        <i class="fas fa-paper-plane me-2"></i>Submit for Review
                    </button>
                </div>
                {% elif assignment.workflow_stage == 'approved' %}
                <div class="d-grid gap-2">
                    <form method="POST" action="{{ url_for('lms_content_management.assignment_publish', assignment_id=assignment.id) }}" 
                          onsubmit="return confirm('Are you sure you want to publish this assignment?')">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-globe me-2"></i>Publish Assignment
                        </button>
                    </form>
                </div>
                {% endif %}
                
                <hr>
                
                <div class="small text-muted">
                    <p class="mb-1"><i class="fas fa-eye me-2"></i>Assignment ID: {{ assignment.id }}</p>
                    <p class="mb-0"><i class="fas fa-clock me-2"></i>Last updated: {{ assignment.updated_at.strftime('%b %d, %Y') if assignment.updated_at else assignment.created_at.strftime('%b %d, %Y') }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Approval Modal -->
<div class="modal fade" id="approvalModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Approve Assignment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="approvalForm" method="POST" action="{{ url_for('lms_content_management.approve_assignment', assignment_id=assignment.id) }}">
                    <div class="mb-3">
                        <label for="approvalComments" class="form-label">Comments (Optional)</label>
                        <textarea class="form-control" id="approvalComments" name="comments" rows="3" 
                                  placeholder="Add any comments about the approval..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="submitApproval()">Approve Assignment</button>
            </div>
        </div>
    </div>
</div>

<!-- Rejection Modal -->
<div class="modal fade" id="rejectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Reject Assignment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="rejectionForm" method="POST" action="{{ url_for('lms_content_management.reject_assignment', assignment_id=assignment.id) }}">
                    <div class="mb-3">
                        <label for="rejectionReason" class="form-label">Rejection Reason *</label>
                        <textarea class="form-control" id="rejectionReason" name="rejection_reason" rows="3" 
                                  placeholder="Please provide a reason for rejection..." required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="submitRejection()">Reject Assignment</button>
            </div>
        </div>
    </div>
</div>

<!-- Unpublish Modal -->
<div class="modal fade" id="unpublishModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Unpublish Assignment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warning:</strong> Unpublishing will revert this assignment to draft status and require re-approval before publishing again.
                </div>
                <form id="unpublishForm" method="POST" action="{{ url_for('lms_content_management.assignment_unpublish', assignment_id=assignment.id) }}">
                    <div class="mb-3">
                        <label for="unpublishReason" class="form-label">Reason for Unpublishing *</label>
                        <textarea class="form-control" id="unpublishReason" name="unpublish_reason" rows="3" 
                                  placeholder="Please provide a reason for unpublishing..." required></textarea>
                        <div class="form-text">This will help track why the assignment was unpublished.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="submitUnpublish()">Unpublish Assignment</button>
            </div>
        </div>
    </div>
</div>

<!-- Revision Modal -->
<div class="modal fade" id="revisionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Assignment Revision</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Info:</strong> This will create a new draft copy of the assignment that you can edit separately from the published version.
                </div>
                <form id="revisionForm" method="POST" action="{{ url_for('lms_content_management.assignment_create_revision', assignment_id=assignment.id) }}">
                    <div class="mb-3">
                        <label for="revisionNotes" class="form-label">Revision Notes *</label>
                        <textarea class="form-control" id="revisionNotes" name="revision_notes" rows="3" 
                                  placeholder="Describe what changes you plan to make in this revision..." required></textarea>
                        <div class="form-text">These notes will help track the purpose of this revision.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitRevision()">Create Revision</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Assignment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this assignment?</p>
                <p class="text-danger"><strong>This action cannot be undone!</strong></p>
                <p><strong>Assignment:</strong> {{ assignment.assignment_title }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="POST" action="{{ url_for('lms_content_management.assignment_delete', assignment_id=assignment.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger">Delete Assignment</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function approveAssignment() {
    new bootstrap.Modal(document.getElementById('approvalModal')).show();
}

function rejectAssignment() {
    new bootstrap.Modal(document.getElementById('rejectionModal')).show();
}

function submitApproval() {
    document.getElementById('approvalForm').submit();
}

function submitRejection() {
    const reason = document.getElementById('rejectionReason').value.trim();
    if (!reason) {
        alert('Please provide a rejection reason');
        return;
    }
    document.getElementById('rejectionForm').submit();
}

function submitForReview() {
    if (confirm('Are you sure you want to submit this assignment for review?')) {
        fetch(`/admin/content/assignments/{{ assignment.id }}/submit-review`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        }).then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('Assignment submitted for review!', 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast(data.error || 'Failed to submit for review', 'error');
            }
        }).catch(error => {
            showToast('Error submitting for review', 'error');
        });
    }
}

function confirmDelete() {
    new bootstrap.Modal(document.getElementById('deleteModal')).show();
}

function showUnpublishModal() {
    new bootstrap.Modal(document.getElementById('unpublishModal')).show();
}

function showRevisionModal() {
    new bootstrap.Modal(document.getElementById('revisionModal')).show();
}

function submitUnpublish() {
    const reason = document.getElementById('unpublishReason').value.trim();
    if (!reason) {
        alert('Please provide a reason for unpublishing');
        return;
    }
    document.getElementById('unpublishForm').submit();
}

function submitRevision() {
    const notes = document.getElementById('revisionNotes').value.trim();
    if (!notes) {
        alert('Please provide revision notes');
        return;
    }
    document.getElementById('revisionForm').submit();
}

function showEditHistory() {
    // Show edit history information
    const editCount = {{ assignment.edit_count_post_publish or 0 }};
    const lastEdit = '{{ assignment.last_published_edit.strftime("%b %d, %Y %I:%M %p") if assignment.last_published_edit else "" }}';
    const unpublishedAt = '{{ assignment.unpublished_at.strftime("%b %d, %Y %I:%M %p") if assignment.unpublished_at else "" }}';
    const unpublishReason = '{{ assignment.unpublish_reason or "" }}';
    
    let historyInfo = '';
    if (editCount > 0) {
        historyInfo += `This assignment has been edited ${editCount} time(s) after publication.\n`;
    }
    if (lastEdit) {
        historyInfo += `Last edit: ${lastEdit}\n`;
    }
    if (unpublishedAt) {
        historyInfo += `Unpublished: ${unpublishedAt}\n`;
        historyInfo += `Reason: ${unpublishReason}\n`;
    }
    
    if (historyInfo) {
        alert('Assignment Edit History:\n\n' + historyInfo);
    } else {
        alert('No edit history available for this assignment.');
    }
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `toast position-fixed top-0 end-0 m-3`;
    toast.innerHTML = `
        <div class="toast-body bg-${type === 'success' ? 'success' : 'danger'} text-white">
            ${message}
        </div>
    `;
    document.body.appendChild(toast);
    
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3000);
}
</script>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 10px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #dee2e6;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -20px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
}

.timeline-content {
    padding-left: 10px;
}

.assignment-instructions {
    white-space: pre-wrap;
    line-height: 1.6;
}
</style>
{% endblock %}
